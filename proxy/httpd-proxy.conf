LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule headers_module modules/mod_headers.so

<VirtualHost *:80>
    ServerName localhost

    ProxyPreserveHost On
    ProxyRequests Off
    ProxyTimeout 300

    # Headers para CORS y forwarding
    Header set Access-Control-Allow-Origin "*"
    Header set X-Forwarded-Proto "https"

    # --- API → Spring Boot Backend ---
    # CAMBIO: Usamos /api/ con RewriteRule para quitar el /api del path
    RewriteEngine On
    RewriteRule ^/api/(.*)$ __API_BACKEND_URL__/$1 [P,L]
    ProxyPassReverse "/api/" "__API_BACKEND_URL__/"

    # --- Todo lo demás → PHP Frontend ---
    ProxyPass        "/" "__FRONTEND_URL__/" timeout=300
    ProxyPassReverse "/" "__FRONTEND_URL__/"

    # Logs para debugging
    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 common
</VirtualHost>